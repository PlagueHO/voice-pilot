{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://voicepilot/spec/threat-register.schema.json",
  "title": "VoicePilot Threat Register Schema",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "lastUpdated", "threats"],
  "properties": {
    "$schema": {
      "type": "string",
      "pattern": "^(https?:\\/\\/.+|\\./.+)$"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "lastUpdated": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "threats": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/threatRecord"
      }
    }
  },
  "$defs": {
    "mitigationRef": {
      "type": "object",
      "additionalProperties": false,
      "required": ["spec", "control", "verification"],
      "properties": {
        "spec": {
          "type": "string",
          "pattern": "^SP-\\d{3}$"
        },
        "control": {
          "type": "string",
          "minLength": 1
        },
        "verification": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "threatRecord": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "threatId",
        "title",
        "stride",
        "asset",
        "description",
        "dreadScore",
        "mitigations",
        "residualRisk",
        "status",
        "owner",
        "reviewCadence"
      ],
      "properties": {
        "threatId": {
          "type": "string",
          "pattern": "^VP-THR-\\d{3}$"
        },
        "title": {
          "type": "string",
          "minLength": 1
        },
        "stride": {
          "type": "string",
          "enum": ["S", "T", "R", "I", "D", "E"]
        },
        "asset": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "dreadScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "mitigations": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/mitigationRef"
          }
        },
        "residualRisk": {
          "type": "string",
          "enum": ["Low", "Medium", "High"]
        },
        "status": {
          "type": "string",
          "enum": ["Open", "Mitigated", "Accepted"]
        },
        "owner": {
          "type": "string",
          "minLength": 1
        },
        "reviewCadence": {
          "type": "string",
          "enum": ["pre-release", "quarterly", "monthly", "weekly"]
        },
        "references": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    }
  }
}
